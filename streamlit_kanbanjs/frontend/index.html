<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: transparent;
            font-family: sans-serif;
        }
        
        #board {
            display: flex;
            flex-direction: row;
            flex-wrap: nowrap;
            gap: 20px;
            overflow-x: auto;
            padding-bottom: 20px;
            min-height: 600px;
        }
        
        .container {
            flex: 0 0 var(--container-width, 300px);
            border-radius: 10px;
            padding: 15px;
            min-height: 500px;
            transition: background-color 0.3s;
        }
        
        .container h3 {
            margin: 0 0 15px 0;
            padding: 10px;
            background: rgba(0,0,0,0.1);
            border-radius: 5px;
            text-align: center;
            position: sticky;
            top: 0;
            backdrop-filter: blur(5px);
        }
        
        .item-list {
            min-height: 400px;
        }
        
        .item {
            background: white;
            margin: 8px 0;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
            cursor: move;
            user-select: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .item:hover {
            background: #f8f9fa;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            transform: translateY(-2px);
            transition: all 0.2s;
        }
        
        .item:active {
            cursor: grabbing;
            opacity: 0.8;
        }
        
        /* Pasek przewijania */
        #board::-webkit-scrollbar {
            height: 12px;
        }
        
        #board::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 6px;
        }
        
        #board::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 6px;
        }
        
        #board::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        .sortable-ghost {
            opacity: 0.4;
            background: #c8ebfb;
            border: 2px dashed #3498db;
        }
        
        .sortable-drag {
            opacity: 0.8;
            transform: rotate(2deg);
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
        }
    </style>
</head>
<body>
    <div id="board"></div>
    
    <script>
        function initKanban() {
            try {
                const data = /* CONTAINERS_DATA */;
                const containersData = data.containers;
                const containerColors = data.colors;
                const componentKey = data.component_key;
                const containerWidth = data.container_width || 300;
                
                if (!containersData || !Array.isArray(containersData)) {
                    console.error('Brak danych kontenerów');
                    return;
                }
                
                const board = document.getElementById('board');
                if (!board) return;
                
                board.innerHTML = '';
                
                // Ustaw zmienną CSS dla szerokości kontenera
                board.style.setProperty('--container-width', containerWidth + 'px');
                
                containersData.forEach((container, i) => {
                    if (!container || !container.header) return;
                    
                    const containerDiv = document.createElement('div');
                    containerDiv.className = 'container';
                    containerDiv.dataset.containerId = i;
                    containerDiv.style.backgroundColor = (containerColors && containerColors[i]) || '#f0f2f6';
                    
                    const header = document.createElement('h3');
                    header.textContent = container.header;
                    if (containerColors && containerColors[i]) {
                        header.style.background = `linear-gradient(135deg, ${containerColors[i]}dd, ${containerColors[i]}99)`;
                    }
                    
                    const itemList = document.createElement('div');
                    itemList.className = 'item-list';
                    itemList.id = `list-${i}`;
                    
                    if (container.items && Array.isArray(container.items)) {
                        container.items.forEach(item => {
                            if (!item) return;
                            
                            const itemDiv = document.createElement('div');
                            itemDiv.className = 'item';
                            itemDiv.dataset.id = item.toString();
                            itemDiv.textContent = item.toString();
                            itemList.appendChild(itemDiv);
                        });
                    }
                    
                    containerDiv.appendChild(header);
                    containerDiv.appendChild(itemList);
                    board.appendChild(containerDiv);
                });
                
                const lists = document.querySelectorAll('.item-list');
                
                lists.forEach(list => {
                    new Sortable(list, {
                        group: 'shared',
                        animation: 200,
                        ghostClass: 'sortable-ghost',
                        dragClass: 'sortable-drag',
                        handle: '.item',
                        
                        onEnd: function(evt) {
                            const resultData = {
                                type: 'move',
                                item: evt.item ? evt.item.dataset.id : null,
                                from: evt.from ? evt.from.id : null,
                                to: evt.to ? evt.to.id : null,
                                oldIndex: evt.oldIndex,
                                newIndex: evt.newIndex,
                                containerFrom: evt.from ? evt.from.id.replace('list-', '') : null,
                                containerTo: evt.to ? evt.to.id.replace('list-', '') : null
                            };
                            
                            if (componentKey) resultData.key = componentKey;
                            
                            if (window.Streamlit) {
                                window.Streamlit.setComponentValue(resultData);
                            }
                        },
                        
                        onUpdate: function(evt) {
                            const resultData = {
                                type: 'reorder',
                                item: evt.item ? evt.item.dataset.id : null,
                                container: evt.from ? evt.from.id : null,
                                oldIndex: evt.oldIndex,
                                newIndex: evt.newIndex
                            };
                            
                            if (componentKey) resultData.key = componentKey;
                            
                            if (window.Streamlit) {
                                window.Streamlit.setComponentValue(resultData);
                            }
                        }
                    });
                });
                
            } catch (e) {
                console.error('Błąd inicjalizacji Kanban:', e);
            }
        }
        
        // Reszta kodu bez zmian...
        function sendHeight() {
            if (window.Streamlit) {
                window.Streamlit.setFrameHeight(document.body.scrollHeight);
            }
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initKanban);
        } else {
            initKanban();
        }
        
        window.addEventListener('resize', sendHeight);
        
        if (window.Streamlit) {
            window.Streamlit.setComponentReady();
        }
    </script>
</body>
</html>
